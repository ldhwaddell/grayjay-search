(()=>{"use strict";var e=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","isindex","keygen","link","menuitem","meta","nextid","param","source","track","wbr"],r=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,n=function(n){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},o=n.match(/<\/?([^\s]+?)[/\s>]/);if(o&&(t.name=o[1],t.voidElement=e.includes(o[1])||"/"===n.charAt(n.length-2),t.name.startsWith("!--"))){var i=n.indexOf("--\x3e");return{type:"comment",comment:-1!==i?n.slice(4,i):""}}for(var a=new RegExp(r),c=null;null!==(c=a.exec(n));)if(c[0].trim())if(c[1]){var s=c[1].trim(),u=[s,""];s.indexOf("=")>-1&&(u=s.split("=")),t.attrs[u[0]]=u[1],a.lastIndex--}else c[2]&&(t.attrs[c[2]]=c[3].trim().substring(1,c[3].length-1));return t},t=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,o=/^\s*$/,i=Object.create(null),a=function(e,r,n,t){return new(n||(n=Promise))((function(o,i){function a(e){try{s(t.next(e))}catch(e){i(e)}}function c(e){try{s(t.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?o(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(a,c)}s((t=t.apply(e,r||[])).next())}))},c=function(e,r){var n,t,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,t&&(o=2&c[0]?t.return:c[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,c[1])).done)return o;switch(t=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,t=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=r.call(e,a)}catch(e){c=[6,e],t=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},s=function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))},u="games",l=function(){function e(){}var r;return r=e,e.get=function(e){return void 0===e&&(e=u),a(void 0,void 0,void 0,(function(){return c(r,(function(r){return[2,new Promise((function(r,n){chrome.storage.local.get([e],(function(t){var o;if(chrome.runtime.lastError)n(new Error(chrome.runtime.lastError.message));else{var i=null!==(o=t[e])&&void 0!==o?o:[];r(i)}}))}))]}))}))},e.add=function(e){return a(void 0,void 0,void 0,(function(){var n,t;return c(r,(function(r){switch(r.label){case 0:return e&&e.length?[4,this.get()]:[2];case 1:return n=r.sent(),t=s(s([],n,!0),e,!0),[2,new Promise((function(e,r){var n;chrome.storage.local.set(((n={})[u]=t,n),(function(){chrome.runtime.lastError&&r(new Error(chrome.runtime.lastError.message)),e()}))}))]}}))}))},e.remove=function(e){return a(void 0,void 0,void 0,(function(){var n,t;return c(r,(function(r){switch(r.label){case 0:return e&&e.length?[4,this.get()]:[2];case 1:return n=r.sent(),t=n.filter((function(r){return!e.includes(r.id)})),[2,new Promise((function(e,r){var n;chrome.storage.local.set(((n={})[u]=t,n),(function(){chrome.runtime.lastError&&r(new Error(chrome.runtime.lastError.message)),e()}))}))]}}))}))},e}(),f=function(e,r,n,t){return new(n||(n=Promise))((function(o,i){function a(e){try{s(t.next(e))}catch(e){i(e)}}function c(e){try{s(t.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?o(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(a,c)}s((t=t.apply(e,r||[])).next())}))},h=function(e,r){var n,t,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,t&&(o=2&c[0]?t.return:c[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,c[1])).done)return o;switch(t=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,t=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=r.call(e,a)}catch(e){c=[6,e],t=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},p=/^https?:\/\/(?:www\.)?grayjayleagues\.com\/.*[?&]all_games=1(&|$).*/,d=!1,v=function(e){var r;return"tag"===e.type&&"input"===e.name&&void 0!==(null===(r=e.attrs)||void 0===r?void 0:r.readonly)&&"string"==typeof e.attrs.value},m=function(e,r,n){return void 0===n&&(n=1e3),f(void 0,void 0,void 0,(function(){var t,o;return h(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,7]),[4,fetch(e)];case 1:return(t=i.sent()).ok?[4,t.text()]:[3,3];case 2:return[2,i.sent()];case 3:throw new Error("Invalid response code: ".concat(t.status," for ").concat(e));case 4:return o=i.sent(),console.error("Error fetching ".concat(e,": ").concat(o)),r>1?[4,(a=n,new Promise((function(e){return setTimeout(e,a)})))]:[3,6];case 5:return i.sent(),[2,m(e,r-1,n)];case 6:throw new Error("Unable to scrape: ".concat(e," after ").concat(r," retries"));case 7:return[2]}var a}))}))},y=function(e){return f(void 0,void 0,void 0,(function(){var r,a,c,s,u;return h(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,m(e,3)];case 1:return r=l.sent(),a=function(e,r){void 0===r&&(r={}),r||(r={}),r.components||(r.components=i);var a,c=[],s=[],u=-1,l=!1;if(0!==e.indexOf("<")){var f=e.indexOf("<");c.push({type:"text",content:-1===f?e:e.substring(0,f)})}return e.replace(t,(function(t,i){if(l){if(t!=="</"+a.name+">")return"";l=!1}var f,h="/"!==t.charAt(1),p=t.startsWith("\x3c!--"),d=i+t.length,v=e.charAt(d);if(p){var m=n(t);return u<0?(c.push(m),c):((f=s[u])&&f.children&&Array.isArray(f.children)&&f.children.push(m),c)}if(h&&(u++,"tag"===(a=n(t)).type&&a.name&&r.components&&r.components[a.name]&&(a.type="component",l=!0),!a.voidElement&&!l&&v&&"<"!==v&&Array.isArray(a.children)&&a.children.push({type:"text",content:e.slice(d,e.indexOf("<",d))}),0===u&&c.push(a),(f=s[u-1])&&f.children&&f.children.push(a),s[u]=a),(!h||a.voidElement)&&(u>-1&&(a.voidElement||a.name===t.slice(2,-1))&&(u--,a=-1===u?c:s[u]),!l&&"<"!==v&&v)){f=-1===u?c:s[u].children;var y=e.indexOf("<",d),g=e.slice(d,-1===y?void 0:y);o.test(g)&&(g=" "),(y>-1&&u+f.length>=0||" "!==g)&&f&&Array.isArray(f)&&f.push({type:"text",content:g})}})),c}(r),c=function(e){for(var r=[],n=function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))}([],e,!0);n.length>0;){var t=n.pop();t&&(v(t)&&r.push(t.attrs.value),t.children&&n.push.apply(n,t.children))}return r}(a),s=Number(e.split("/").pop()),[2,{url:e,id:s,referee1:c[5],referee2:c[4],linesPerson1:c[3],linesPerson2:c[2],timeKeeper1:c[1],timeKeeper2:c[0]}];case 2:return u=l.sent(),console.error("Error fetching game data for URL: ".concat(e),u),[2,null];case 3:return[2]}}))}))};chrome.runtime.onMessage.addListener((function(e,r,n){switch(e.type){case"CHECK_VALID_URL":return function(e){f(void 0,void 0,void 0,(function(){var r,n;return h(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,f(void 0,void 0,void 0,(function(){var e,r;return h(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,chrome.tabs.query({active:!0,currentWindow:!0})];case 1:return[2,{isValidUrl:!!(e=n.sent()[0]).url&&(t=e.url,p.test(t))}];case 2:return r=n.sent(),console.error("Error checking if the tab URL is valid:",r),[2,{isValidUrl:!1}];case 3:return[2]}var t}))}))];case 1:return r=t.sent(),e(r),[3,3];case 2:return n=t.sent(),console.error("Error checking active tab URL: ",n),e({isValidUrl:!1}),[3,3];case 3:return[2]}}))}))}(n),!0;case"PROCESS_LINKS":return function(e,r){f(void 0,void 0,void 0,(function(){var n,t,o,i;return h(this,(function(a){switch(a.label){case 0:return d?(console.warn("Already processing links. Ignoring new request to process links."),e({requestRescrape:!1}),[2]):(d=!0,(n=r.links)&&n.length?(e({requestRescrape:!1}),[4,l.get()]):(console.warn("Empty list of game links received. Requesting re-scrape"),e({requestRescrape:!0}),[2]));case 1:return t=a.sent(),c=n,s=t,u=new Set(c.map((function(e){return Number(e.split("/").pop())}))),p=new Set(s.map((function(e){return e.id}))),o=[c.filter((function(e){return!p.has(Number(e.split("/").pop()))})),s.filter((function(e){return!u.has(e.id)})).map((function(e){return e.id}))],i=o[1],function(e){f(void 0,void 0,void 0,(function(){var r,n,t,o,i,a;return h(this,(function(c){switch(c.label){case 0:if(!e||!e.length)return[2];r=5,n=[],t=0,c.label=1;case 1:if(!(t<e.length))return[3,6];o=e.slice(t,t+r),c.label=2;case 2:return c.trys.push([2,4,,5]),[4,Promise.all(o.map((function(e){return y(e)})))];case 3:return i=c.sent(),l.add(i.filter((function(e){return null!==e}))),[3,5];case 4:return a=c.sent(),console.error("Error with a chunk:",o,a),[3,5];case 5:return t+=r,[3,1];case 6:return d=!1,[2,n]}}))}))}(o[0]),l.remove(i),[2]}var c,s,u,p}))}))}(n,e),!0;case"ERROR_SCRAPING_LINKS":return console.error("Unable to scrape game links. Please refresh page"),!0}}))})();
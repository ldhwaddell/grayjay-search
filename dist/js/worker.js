(()=>{"use strict";var e=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","isindex","keygen","link","menuitem","meta","nextid","param","source","track","wbr"],n=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,r=function(r){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},a=r.match(/<\/?([^\s]+?)[/\s>]/);if(a&&(t.name=a[1],t.voidElement=e.includes(a[1])||"/"===r.charAt(r.length-2),t.name.startsWith("!--"))){var o=r.indexOf("--\x3e");return{type:"comment",comment:-1!==o?r.slice(4,o):""}}for(var i=new RegExp(n),s=null;null!==(s=i.exec(r));)if(s[0].trim())if(s[1]){var c=s[1].trim(),u=[c,""];c.indexOf("=")>-1&&(u=c.split("=")),t.attrs[u[0]]=u[1],i.lastIndex--}else s[2]&&(t.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return t},t=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,a=/^\s*$/,o=Object.create(null),i=function(){function e(){}var n;return n=e,e.get=function(e){return void 0===e&&(e=["games"]),r=void 0,t=void 0,o=function(){return function(e,n){var r,t,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,t&&(a=2&s[0]?t.return:s[0]?t.throw||((a=t.return)&&a.call(t),0):t.next)&&!(a=a.call(t,s[1])).done)return a;switch(t=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,t=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],t=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(n,(function(n){return[2,new Promise((function(n,r){chrome.storage.local.get(e,(function(e){chrome.runtime.lastError&&r(new Error(chrome.runtime.lastError.message)),n(e)}))}))]}))},new((a=void 0)||(a=Promise))((function(e,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function s(e){try{c(o.throw(e))}catch(e){n(e)}}function c(n){var r;n.done?e(n.value):(r=n.value,r instanceof a?r:new a((function(e){e(r)}))).then(i,s)}c((o=o.apply(r,t||[])).next())}));var r,t,a,o},e.add=function(e){},e.update=function(e,n){void 0===e&&(e=[]),void 0===n&&(n=[])},e.remove=function(e){void 0===e&&(e=[])},e}(),s=function(e,n,r,t){return new(r||(r=Promise))((function(a,o){function i(e){try{c(t.next(e))}catch(e){o(e)}}function s(e){try{c(t.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?a(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,s)}c((t=t.apply(e,n||[])).next())}))},c=function(e,n){var r,t,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,t&&(a=2&s[0]?t.return:s[0]?t.throw||((a=t.return)&&a.call(t),0):t.next)&&!(a=a.call(t,s[1])).done)return a;switch(t=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,t=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],t=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},u=/^https?:\/\/(?:www\.)?grayjayleagues\.com\/.*[?&]all_games=1(&|$).*/,l=!1,f=function(e){return"tag"===e.type&&"input"===e.name&&null!=e.attrs&&void 0!==e.attrs.readonly&&"string"==typeof e.attrs.value},h=function(e){return s(void 0,void 0,void 0,(function(){var n,i,u,l,h;return c(this,(function(p){switch(p.label){case 0:return p.trys.push([0,3,,4]),[4,(d=e,3,new Promise((function(e,n){return s(void 0,void 0,void 0,(function(){var r,t,a,o,i;return c(this,(function(s){switch(s.label){case 0:s.trys.push([0,10,,11]),r=0,s.label=1;case 1:if(!(r<=3))return[3,9];s.label=2;case 2:return s.trys.push([2,7,,8]),[4,fetch(d)];case 3:return(t=s.sent()).ok?[4,t.text()]:[3,5];case 4:return a=s.sent(),e(a),[2];case 5:r<3&&console.warn("Retrying: ".concat(d)),s.label=6;case 6:return[3,8];case 7:return o=s.sent(),3===r?(console.error("Unable to fetch link after ".concat(3," retries: ").concat(d,": ").concat(o.message)),n(o),[2]):[3,8];case 8:return r++,[3,1];case 9:return n(new Error("Max retries reached")),[3,11];case 10:return i=s.sent(),n(i),[3,11];case 11:return[2]}}))}))})))];case 1:return(n=p.sent())?[4,n.text()]:[2,null];case 2:return i=p.sent(),u=function(e,n){void 0===n&&(n={}),n||(n={}),n.components||(n.components=o);var i,s=[],c=[],u=-1,l=!1;if(0!==e.indexOf("<")){var f=e.indexOf("<");s.push({type:"text",content:-1===f?e:e.substring(0,f)})}return e.replace(t,(function(t,o){if(l){if(t!=="</"+i.name+">")return"";l=!1}var f,h="/"!==t.charAt(1),p=t.startsWith("\x3c!--"),d=o+t.length,v=e.charAt(d);if(p){var m=r(t);return u<0?(s.push(m),s):((f=c[u])&&f.children&&Array.isArray(f.children)&&f.children.push(m),s)}if(h&&(u++,"tag"===(i=r(t)).type&&i.name&&n.components&&n.components[i.name]&&(i.type="component",l=!0),!i.voidElement&&!l&&v&&"<"!==v&&Array.isArray(i.children)&&i.children.push({type:"text",content:e.slice(d,e.indexOf("<",d))}),0===u&&s.push(i),(f=c[u-1])&&f.children&&f.children.push(i),c[u]=i),(!h||i.voidElement)&&(u>-1&&(i.voidElement||i.name===t.slice(2,-1))&&(u--,i=-1===u?s:c[u]),!l&&"<"!==v&&v)){f=-1===u?s:c[u].children;var y=e.indexOf("<",d),g=e.slice(d,-1===y?void 0:y);a.test(g)&&(g=" "),(y>-1&&u+f.length>=0||" "!==g)&&f&&Array.isArray(f)&&f.push({type:"text",content:g})}})),s}(i),l=function(e){for(var n=[],r=function(e,n,r){if(r||2===arguments.length)for(var t,a=0,o=n.length;a<o;a++)!t&&a in n||(t||(t=Array.prototype.slice.call(n,0,a)),t[a]=n[a]);return e.concat(t||Array.prototype.slice.call(n))}([],e,!0);r.length>0;){var t=r.pop();t&&(f(t)&&n.push(t.attrs.value),t.children&&r.push.apply(r,t.children))}return n}(u),[2,{gameId:Number(e.split("/").pop()),referee1:l[5],referee2:l[4],linesPerson1:l[3],linesPerson2:l[2],timeKeeper1:l[1],timeKeeper2:l[0]}];case 3:return h=p.sent(),console.error("Error fetching game data for link: ".concat(e),h),[2,null];case 4:return[2]}var d}))}))};chrome.runtime.onMessage.addListener((function(e,n,r){switch(e.type){case"CHECK_VALID_URL":return function(e){s(void 0,void 0,void 0,(function(){var n,r;return c(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,s(void 0,void 0,void 0,(function(){var e,n,r;return c(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e={active:!0,currentWindow:!0},[4,chrome.tabs.query(e)];case 1:return[2,{isValidUrl:!!(n=t.sent()[0])&&!!(a=n.url)&&u.test(a)}];case 2:return r=t.sent(),console.error("Error checking if the tab URL is valid:",r),[2,{isValidUrl:!1}];case 3:return[2]}var a}))}))];case 1:return n=t.sent(),e(n),[3,3];case 2:return r=t.sent(),console.error("Error checking active tab URL: ",r),e({isValidUrl:!1}),[3,3];case 3:return[2]}}))}))}(r),!0;case"PROCESS_LINKS":return function(e,n){s(void 0,void 0,void 0,(function(){var n,r;return c(this,(function(t){switch(t.label){case 0:return l?(console.warn("Already processing links. Ignoring new request to process links."),e({requestRescrape:!1}),[2]):(l=!0,(n=["https://grayjayleagues.com/47/115/173/311/0/officials/games/landing/42650","https://grayjayleagues.com/47/115/173/311/0/officials/games/landing/43122","https://grayjayleagues.com/47/115/173/311/0/officials/games/landing/sadasda","https://grayjayleagues.com/47/115/173/311/0/officials/games/landing/43123"])&&n.length?(e({requestRescrape:!1}),[4,i.get()]):(console.warn("Empty list of game links received. Requesting re-scrape"),e({requestRescrape:!0}),[2]));case 1:return(r=t.sent())&&r.length||function(e){s(void 0,void 0,void 0,(function(){var n,r,t,a,o,i;return c(this,(function(s){switch(s.label){case 0:n=5,r=[],t=0,s.label=1;case 1:if(!(t<e.length))return[3,6];a=e.slice(t,t+n),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,Promise.all(a.map((function(e){return h(e)})))];case 3:return o=s.sent(),console.log(o),[3,5];case 4:return i=s.sent(),console.error("Error with a chunk:",a,i),[3,5];case 5:return t+=n,[3,1];case 6:return l=!1,[2,r]}}))}))}(n),[2]}}))}))}(r),!0;case"ERROR_SCRAPING_LINKS":return console.error("Unable to scrape game links. Please refresh page"),!0}}))})();